##################################################
###################### v4l2 ######################
##################################################
export V4L2_DEVICE="/dev/video0"

# --- 정보 조회용 Alias ---
# 장치의 모든 정보 표시
alias v4l-all='v4l2-ctl -d "${V4L2_DEVICE}" --all'

# 지원하는 포맷/해상도/프레임레이트 상세 목록
alias v4l-formats='v4l2-ctl -d "${V4L2_DEVICE}" --list-formats-ext'

# 지원하는 컨트롤 목록 (밝기, 노출 등)
alias v4l-ctrls='v4l2-ctl -d "${V4L2_DEVICE}" -L'


# --- 컨트롤 설정/조회용 함수 ---
# 특정 컨트롤의 현재 값 확인 (사용법: v4l-get brightness)
v4l-get() {
    v4l2-ctl -d "${V4L2_DEVICE}" -C "$1"
}

# 특정 컨트롤 값 설정 (사용법: v4l-set brightness 150)
v4l-set() {
    v4l2-ctl -d "${V4L2_DEVICE}" -c "$1=$2"
}


# --- 프레임 캡처용 함수 ---
# raw 프레임 1장 캡처 (사용법: v4l-capture [저장할_파일명.raw])
v4l-capture() {
    local filename="${1:-capture.raw}"
    echo "Capturing 1 frame to ${filename} from ${V4L2_DEVICE}..."
    v4l2-ctl -d "${V4L2_DEVICE}" --stream-mmap --stream-count=1 --stream-to="${filename}"
    echo "Done."
}


#################################################
###################### gst ######################
#################################################
# --- 기본 명령어 단축 Alias ---
alias gsti='gst-inspect-1.0'
alias gstdm='gst-device-monitor-1.0'

alias gstl='gst-launch-1.0'
alias gstl-v='gst-launch-1.0 -v'


# --- 일반 카메라 테스트 함수 ---
# V4L2 카메라 장치를 간단히 테스트 (gst-cam-test [장치경로])
gst-cam-test() {
    local device="${1:-/dev/video0}"
    gst-launch-1.0 -v v4l2src device="${device}" ! videoconvert ! autovideosink
}

# --- Jetson 전용 카메라 테스트 함수 ---
# Jetson의 ISP를 사용하는 nvargus 카메라 테스트 (1080p 기본)
gst-nvcam-test() {
    gst-launch-1.0 -v nvarguscamerasrc ! 'video/x-raw(memory:NVMM), width=1920, height=1080' ! nvvidconv ! autovideosink
}

# --- 파일 및 네트워크 스트림 테스트 함수 ---
# 로컬 비디오 파일 재생 (gst-play <파일경로>)
gst-play() {
    gst-launch-1.0 -v filesrc location="$1" ! decodebin ! autovideosink
}

# RTSP 네트워크 스트림 재생
# 사용법: gst-rtsp-play <RTSP_URL> (예시: gst-rtsp-play rtsp://192.168.1.100/stream)
gst-rtsp-play() {
    gst-launch-1.0 -v rtspsrc location="$1" latency=0 ! decodebin ! autovideosink
}
